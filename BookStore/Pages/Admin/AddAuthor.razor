@page "/AddAuthor"
@using BookStore.Data;
@using BookStore.Data.Repositories.Admin;
@using BookStore.Entities;
@using Microsoft.EntityFrameworkCore;

@inject IDbContextFactory<DataContext> ContextFactory;

<AuthorizeView Roles="Admin">
    <Authorized>
        <div class="form-control d-flex flex-column m-auto  p-5 m-3" style="max-width:900px">

            <h4>Add a new author</h4>

            @*Author Name*@
            <label for="name" class="form-label"> name</label>
            <input id="name" type="text" class="form-input form-control" @bind-value="_createdAuthor.Name"/>

            @*Biography*@
            <label for="biography" class="form-label"> biography</label>
            <input id="biography" type="text" class="form-input form-control" @bind-value="_createdAuthor.Biography" />

            @*BirthDate*@
            <label for="birth-date" class="form-label"> birth date</label>
            <input id="birth-date" type="number" class="form-input form-control" @bind-value="_createdAuthor.BirthDate" />

            @*Death date*@
            <label for="death-date" class="form-label"> death date</label>
            <input id="death-date" type="number" class="form-input form-control" @bind-value="_createdAuthor.DeathDate" />

            @*Nationality*@
            <label for="death-date" class="form-label"> nationality</label>
            <input id="death-date" type="text" class="form-input form-control" @bind-value="_createdAuthor.Nationality" />
        </div>

        <div class="w-100 text-center p-5"> <button class="btn btn-success btn-lg" @onclick="SaveAuthorAsync">Save author</button></div>
        <div class=" w-100 text-center p-5">
            <div class="alert-success"> @validationMessage</div>
        </div>
    </Authorized>
     
    <NotAuthorized>

    </NotAuthorized>
</AuthorizeView>

@code {

    Author _createdAuthor = new();

    string validationMessage = "";
    async Task ResetValidationMessage()
    {
        await Task.Delay(3000);
        validationMessage = "";
        await InvokeAsync(StateHasChanged);
    }

    async Task SaveAuthorAsync()
    {
        using (var repo = new AuthorRepository(ContextFactory.CreateDbContext()))
        {
            await repo.CreateAuthorAsync(_createdAuthor);
        }

        _createdAuthor = new Author();

        validationMessage = "Author added succesfully";
        await InvokeAsync(StateHasChanged);
       
        await ResetValidationMessage();
        
    }

}
